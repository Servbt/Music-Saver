<script>
  // straight from the google API docs, this is the actuall API request to youtube
  function execute() {
    return gapi.client.youtube.search.list({
      "part": [
        "snippet"
      ],
      "maxResults": 2,
      // from the POST request made in srchPage.ejs, the data is actually passed from the index.js file
      "q": "<%=video.video%>"
    })
      .then(function (response) {
        let list = response.result.items
        console.log(list)
        // Using that response to make a post request serverside (using jquery)
        const body = { videos: list };
        $.post("http://localhost:3000/results", body, (data, status) => {
          console.log("sent data successfully");
        });
        // changing URL manually as well
        $(document).ready(function () {
          var newURL = "http://localhost:3000/results";
          window.location.href = newURL;
        });
      },
        function (err) { console.error("Execute error", err); });
  }
  // to prevent missed promise a timeout is placed to allow for authentication in the apiLoad.ejs file
  setTimeout(function () {
    execute()
  }, 500);
</script>