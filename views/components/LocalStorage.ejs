<!-- if data was passed in from server side then allow for current playlist to be saved -->
<% if (locals.playlist) { %>
    <script>
        let myPlaylist = "<%=playlistString%>";
        function storePlaylist() {
            localStorage.setItem("localPlaylist", myPlaylist);
        }
        $(function () {
            $(".save-playlist").on("click", function (e) {
                storePlaylist();
            });
        });
    </script>
    <% } %>

        <script>
            // variable init/ targetting for functionality
            let jsonObject;
            const hidePlaylist = $(".video-link");
            const localLink = $(".local-playlist");
            const updateLclLink = $(".update-local-playlist");
            const deleteBtn = $(".delete-button");

            function retrievePlaylist() {
                let newPlaylist = localStorage.getItem("localPlaylist");
                // curtesy of chatGPT this code is for decoding myPlaylist into the proper data structure
                var decodedString = new DOMParser().parseFromString(newPlaylist, "text/html").body.textContent;
                var jsonObject = JSON.parse(decodedString);
                console.log(jsonObject);

                // functionality for filling playlist container:
                // loop over each item in local storage playlist and create video cards for each item
                const playlistContainer = $(".local-playlist-cont");
                let count = -1;
                jsonObject.forEach(video => {
                    const title = video.title;
                    const videoId = video.id;
                    const thumbnail = video.thumbnail;
                    count++;
                    playlistContainer.append(
                        `<div class="video-link local-link ${count}">
                        <h1>${title}</h1>
                        <h2>${videoId}</h2>
                        <img src="${thumbnail}" alt="${title}"></img>
                    </div>
                    <button class="local-deleteBtn" id="${count}">
                        Delete From Local playlist
                        </button>
                    `
                    );
                });

                $(function () {
                    // functionality for deleting a video from the local playlist
                    $(document).on("click", ".local-deleteBtn", function (e) {
                    // find index by looking for html id
                        var $thisElement = $(this);
                        var elementId = $thisElement.attr('id');
                        console.log(elementId);
                    // remove and confirm with user
                    playlistContainer.prepend(`<h1>${jsonObject[elementId].title} was removed from local playlist</h1>`)
                        console.log(jsonObject)
                        jsonObject.splice(elementId, 1);
                    });
                    // Same issue with updating Local playlist as above
                    $(document).on("click", ".update-local-playlist", function (e) {
                        localStorage.setItem("localPlaylist", JSON.stringify(jsonObject));
                    });
                });

            };
            // functionality responsible for showing the local playlist on btn click
            $(function () {
                $(".local-playlist").on("click", function (e) {
                    retrievePlaylist();
                    // these two lines hide the local playlist when viewing the current playlist
                    hidePlaylist.toggleClass("hide")
                    deleteBtn.toggleClass("hide")
                    localLink.toggleClass("hide")
                    // this reveals the update tag on playlist.ejs
                    updateLclLink.toggleClass("hide")

                });
            });


        </script>